## Jest で始めるテスト入門

<ul>
<li><a href="#01">Jest入門</a></li>
</ul>

<h3 id="01">Jest入門</h3>

<ul>
<li><a href="#01-1">等価を評価するtoBe、toEqual、toStrictEqualの違い</a></li>
<li><a href="#01-2">toBe、toEqual、toStrictEqualの使い分け</a></li>
<li><a href="#01-3">前後処理が実行されるタイミング</a></li>
<li><a href="#01-4">テストをスキップ</a></li>
<li><a href="#01-5">Jestでのモック化するための関数</a></li>
<li><a href="#01-6">mockに含まれるプロパティ</a></li>
<li><a href="#01-7">mock.resultsに含まれるオブジェクトのtypeプロパティに含まれる値</a></li>
<li><a href="#01-8">モックのリセット</a></li>
<li><a href="#01-9">UIテストの方法</a></li>
</ul>

<br>

<h4 id="01-1">等価を評価するtoBe、toEqual、toStrictEqualの違い</h4>

- `toBe`：プリミティブな値が等しいかを、オブジェクトについては同一インスタンスであるかを比較する。
- `toEqual`：プリミティブな値が等しいかを、オブジェクトについては全プロパティのプリミティブな値が等しいかを、再帰的に比較する。
- `toStrictEqual`：toEqual とほぼ同じだが、次の点で異なる。
  - 未定義のプロパティと undefined を値に持つプロパティとを区別する。
  - 配列中の、未定義の要素（empty）と、値が undefined である要素とを区別する。
  - 生成元のクラスを区別する。

<br>

<h4 id="01-2">toBe、toEqual、toStrictEqualの使い分け</h4>

- `toBe` を利用するケース
  - プリミティブ値を評価
  - 同じオブジェクトんの参照を持つ変数であることを評価（例えば引数として渡したオブジェクトの変数がリターンされることを確認するなど）
- `toEqual` を利用するケース
  - オブジェクトのプロパティ値の評価
- `toStrictEqual` を利用するケース
  - 生成元のクラス名や undefined なプロパティ、Array の empty 値の評価を含めた厳密なオブジェクトの評価

<br>

<h4 id="01-3">前後処理が実行されるタイミング</h4>

- `beforeAll`: describe 内で定義されているすべてのテストの実行前に 1 回実行される
- `beforeEach`: describe 内で定義されているそれぞれのテストの実行前に 1 回実行される
- `afterAll`: describe 内で定義されているすべてのテストの終了後に 1 回実行される
- `afterEach`: describe 内で定義されているそれぞれのテストの終了後に 1 回実行される

<br>

<h4 id="01-4">テストをスキップ</h4>

- `describe.skip` or `xdescribe`: グループ内のテストケースすべてをスキップ
- `test.skip` or `xtest`: テストケースをスキップ
- `it.skip` or `xit`: テストケースをスキップ

<br>

<h4 id="01-5">Jestでのモック化するための関数</h4>

| 関数名         | 概要                                                            |
| -------------- | --------------------------------------------------------------- |
| `jest.fn()`    | モックオブジェクトを作成、次の 2 つの関数と組み合わせて利用する |
| `jest.mock()`  | オブジェクト全体やオブジェクトの一部のメソッドをモック化する    |
| `jest.spyOn()` | オブジェクトの一部のメソッドをモック化する                      |

<br>

<h4 id="01-6">mockに含まれるプロパティ</h4>

| プロパティ | 概要                                                 |
| ---------- | ---------------------------------------------------- |
| `calls`    | モックオブジェクトの呼び出しごとの引数が含まれた配列 |
| `results`  | モックオブジェクトの呼び出しごとの結果が含まれた配列 |

<br>

<h4 id="01-7">mock.resultsに含まれるオブジェクトのtypeプロパティに含まれる値</h4>

| type プロパティの値    | 概要                                                    |
| ---------------------- | ------------------------------------------------------- |
| 'return'（正常終了）   | モックオブジェクトの実行が正常終了した                  |
| 'throw'（異常終了）    | モックオブジェクトの実行が失敗し、エラーが throw された |
| 'incomplete'（実行中） | モックオブジェクトの実行が完了していない                |

<br>

<h4 id="01-8">モックのリセット</h4>

`mockFn`は`jest.fn()`で作成されたモックオブジェクト

##### 特定のモックオブジェクトのリセット

- `mockFn.mockClear()`: mockFn 関数の mock のプロパティをリセットする。
- `mockFn.mockReset()`: mockFn 関数の mock のプロパティをリセットする。設定した mock 関数をクリアする。オリジナルの関数に戻るわけではない。
- `mockFn.mockRestore()`: mockFn 関数をオリジナルの関数へ戻す。`spyOn`を利用して、モック化した関数のみ対象。

##### すべてのモックオブジェクトをリセット

- `jest.clearAllMocks()`: すべてのモックオブジェクトの mock のプロパティをリセットする。
- `jest.resetAllMocks()`: 全てのモックオブジェクトの mock のプロパティをリセットする、設定した mock 関数をクリアする。オリジナルの関数に戻るわけではない。
- `jest.restoreAllMocks()`: すべてのモックオブジェクトの mock 関数をオリジナルの関数へ戻す。`spyOn`を利用して、モック化した関数のみ対象。

<br>

<h4 id="01-9">UIテストの方法</h4>

- jsdom を利用した UI テスト
- react-test-renderer を利用した静的なコンポーネントのスナップショットテスト
- Reast Testing Library を利用した動きのあるコンポーネントのテスト
- Storybook を活用したコンポーネントのテスト

<br>
